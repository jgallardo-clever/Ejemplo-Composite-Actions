# Workflow que nos imprime el nombre del usuario que ejecutó el workflow, la fecha, la hora y lo almacena en un archivo llamado visitantes.txt
name: Quién me visita

on: workflow_dispatch

jobs:
    visitante:
        name: Quién me visita
        runs-on: ubuntu-latest
        steps:
            - name: Checkout del repositorio
              uses: actions/checkout@v2

            - name: Listamos los archivos y carpetas
              run: ls -la -R

            - name: Verificar existencia de get-usuario.yml
              run: test -f ./.github/actions/get-usuario/action.yml || { echo "Archivo get-usuario/action.yml no encontrado"; exit 1; }

            - name: Obtener USUARIO de la variable de entorno creada por el action
              uses: ./.github/actions/get-usuario

            - name: Imprimir visitante
              run: echo "El usuario $USUARIO visitó el archivo a las $(date)" >> visitantes.txt
            
            - name: Mostrar visitantes
              run: cat visitantes.txt
            
            - name: Agregar commit con el archivo visitantes.txt
              run: |
                git config user.name "github-actions[bot]"
                git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
                git add .
                git commit -m "Se agrega al usuario $USUARIO a visitantes.txt"
                git push